{% extends 'layout.html' %}

{% block body %}
    {% include 'includes/_header.html' %}
    {% include 'includes/_searchbar.html' %}

    {% set img_base_url = 'https://image.tmdb.org/t/p/w154' %}

    <!-- display summary media info from themoviedb api call, not from db-->
    <div class="clearfix" style="margin-top: 20px">
        {% if media %}
            <img style="margin-right: 15px; float: left; width: 120px;" src="{{ img_base_url + media['poster_path'] }}" alt="Media result image" />
            <div><strong>{{ media['title'] }} ({{ media['year'] }})</strong></div>
            {% if mtype == 'show' %}
                <div><em>{{ media['number_of_seasons'] }} seasons, {{ media['number_of_episodes'] }} episodes</em></div>
                <div><a href={{ 'https://www.themoviedb.org/tv/{}'.format(media['id']) }}>TheMovieDB</a></div>
            {% else %}
                <div><a href={{ 'https://www.themoviedb.org/movie/{}'.format(media['id']) }}>TheMovieDB</a></div>
            {% endif %}
            <div>{{ media['overview'] }}</div>
            {% if session.logged_in %}
              <div style='margin-top:5px'>
                <form method="POST" action="/api/watchlist"> 
                  <input type="hidden" name="id" value="{{ media['id'] }}" />
                  <input type="hidden" name="mtype" value="{{ mtype }}" />
                  <input type="hidden" name="title" value="{{ media['title'] }}" />
                  <input type="hidden" name="year" value="{{ media['year'] }}" />
                  <button type="submit" class="btn btn-primary">Add to Watchlist</button>
                </form>
              </div>
            {% endif %}
        {% endif %}
    </div>

    {% raw %}
    <div class="clearfix" style="margin-top: 20px;">
    <div id="vueapp">
      <div v-if="sources.length == 0" style="color: red">
        There are no streaming sources for this {{ mtype }}
      </div>
      <div v-else v-for="s in sources" class="source">
        <img class="logo" :src="'/static/' + s.name + '_logo.png'" alt="logo" /> 
        <div class="sourceinfo">
            Stream <a :href="s.link">{{ mtype }}</a> on {{ s.display_name }}
        </div>
      </div>
    </div>
    {% endraw %}

    <script>
        var db_sources = {{ sources|safe }};
        new Vue({
            el: "#vueapp",
            data: {
                sources: db_sources,
                mtype: '{{ mtype }}'
            }
        });
    </script>

{% endblock %}

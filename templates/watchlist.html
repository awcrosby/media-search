{% extends 'layout.html' %}
{% set active_page = 'watchlist' %}

{% block body %}
  {% include 'includes/_searchbar.html' %}
  <div class="clearfix" style="margin-top: 20px;"></div>

  {% raw %}
    <div id="vueapp">
      <input type="checkbox" v-model="hideNoSources" @change=toggleNoSources()> Hide media with no sources
      &nbsp; &nbsp;
      <input type="checkbox" v-model="hideAmzPay" @change="toggleAmzPay()"> Hide Amazon Pay sources<br>
      <div v-if="wlist.length == 0">
        <h3>Watchlist empty... search and add</h3>
      </div>
      <div v-else class="panel panel-default">
        <table class="table table-condensed table-striped">
          <tr>
            <th class="col-md-1"></th>  <th class="col-md-4">Title</th>  <th class="col-md-4">Sources</th>  <th class="col-md-3"></th>
          </tr>
          <template v-for="w in wlist">
            <tr :class="sourceClasses(w)">
              <td v-if="w.mtype == 'show'"><img class="icon" src="static/glyphicon-tv.png" alt="tv icon" /></td>
              <td v-else><img class="icon" src="static/glyphicon-film.png" alt="film icon" /></td>
              <td>{{ w.title }}</td>
              <td>
                <span v-for="s in w.sources" :class="{amzPay: (s.name=='amazon_pay')}">
                  <a :href="s.link">
                    <img class="icon" :src="'static/' + s.name + '_favicon.ico'" alt="" />
                    <span v-if="s.name=='amazon_pay'">$</span>
                  </a>
                  &nbsp;
                </span>
              </td>
              <td><a :href="'/watchlist/delete/' + w.mtype + '/' + w.id">Delete</a></td>
            </tr>
          </template>
        </table>
      </div>
    </div>
  {% endraw %}

    <script>
        var watchlist = {{ watchlist|safe }};
        new Vue({
            el: "#vueapp",
            data: {
                wlist: watchlist,
                hideNoSources: false,
                hideAmzPay: false
            },
            methods: {
                sourceClasses: function(w) {
                    return {
                        noSource: (w.sources.length == 0),
                        noSubSource: ((w.sources.length == 1) && (w.sources[0].name == 'amazon_pay'))
                    }
                },
                toggleNoSources: function() {
                    if (this.hideNoSources) {
                        $('.noSource').css('display', 'none');
                        if (this.hideAmzPay) {
                            $('.noSubSource').css('display', 'none');
                        } else {
                            $('.noSubSource').css('display', '');
                        };
                    } else {
                        $('.noSource').css('display', '');
                        $('.noSubSource').css('display', '');
                    };
                },
                toggleAmzPay: function() {
                    if (this.hideAmzPay) {
                        $('.amzPay').css('display', 'none');
                    } else {
                        $('.amzPay').css('display', '');
                    };
                    this.toggleNoSources();
                }
            }
        });
    </script>

{% endblock %}

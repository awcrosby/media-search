{% extends 'layout.html' %}

{% block body %}
    <div style="margin-top: 6%">  <!-- introduction -->
      <h4>Find if a movie/show is streaming on Netflix, HBO, Hulu, Amazon Prime, or Showtime</h4>
    </div>

    <div class="row">  <!-- search box and buttons-->
      <form method="GET" action="/search">
        <div class="col-md-5">
          <input type="text" class="form-control" placeholder="Terminator ... Mockingjay 2 ... Broad City ...  InuYasha" name="q" value="{{ query }}" autofocus>
        </div>
        <div class="col-md-2">
          <select name="mtype" class="form-control">
            <option value="movie">Search Movies</option>
            <option value="show" {% if mtype == 'show' %} selected {% endif %}>Search Shows</option>
          </select> 
        </div>
        <div class="col-md-2">
          <input type="submit" class="btn btn-primary" value="Search">
        </div>
      </form>
    </div>

    <!-- end-result-ui: a source was found -->
    {% if media and media['src_display'] %}
        <!-- box with media image and description -->
        <div class="clearfix" style="margin-bottom: 20px"></div>
        <div class="row">
          <div class="col-md-2">  
            <img style="margin-right: 2%" src="{{ media['img'] }}" alt="Media result image" />
          </div>
          <div class="col-md-10">
            The {{ mtype }} <strong>{{ media['title'] }} ({{ media['year'] }})</strong>
            <a href='http://www.imdb.com/title/{{ media['imdb'] }}'>imdb</a>
            is available on these streaming services:
            <form method="POST" action="/edit_watchlist">
              <input type="hidden" name="operation" value="add" />
              <input type="hidden" name="mtype" value="{{ mtype }}" />
              <input type="hidden" name="gbid" value="{{ media['id'] }}" />
              <button type="submit" class="btn">+</button>
            </form>
          </div>
        </div>

        <div class="clearfix" style="margin-bottom: 30px"></div>

        {% for s in media['src_display'] %}
            <!-- display logo or title in source boxes -->
            <div class="source">
              {% if s['source'] == 'netflix' %}
                  <img class="logo" src="{{ url_for('static', filename='netflix_logo.png') }}" alt="Netflix logo" />
              {% elif s['source'] == 'hulu_plus' %}
                  <img class="logo" src="{{ url_for('static', filename='hulu_logo.png') }}" alt="Hulu logo" />
              {% elif s['source'] == 'amazon_prime' %}
                  <img class="logo" src="{{ url_for('static', filename='amz_prime_video.jpg') }}" alt="Amazon Prime logo"  />
              {% elif s['source'] == 'hbo_now' %}
                  <img class="logo" src="{{ url_for('static', filename='hbo_logo.png') }}" alt="HBO logo" />
              {% elif s['source'] == 'showtime_subscription' %}
                  <img class="logo" src="{{ url_for('static', filename='showtime_logo.png') }}" alt="Showtime logo" />
              {% elif s['type'] == 'subscription_web_sources' %}
                  <div class="typefree">Stream with Subscription</div>
                  <div class="name">{{ s['display_name'] }}</div>
              {% elif s['type'] == 'tv_everywhere_web_sources' %}
                  <div class="typetvp">Stream with TV Provider Login</div>
                  <div class="name">{{ s['display_name'] }}</div>
                  <div class="sourceinfo">Stream with your cable/sat TV account if you have this channel</div>
              {% elif s['type'] == 'free_web_sources' %}
                  <div class="typefree">Stream Free</div>
                  <div class="name">{{ s['display_name'] }}</div>
              {% endif %}

              <!-- display source info -->
              {% if mtype == 'show' %}
                  <div class="sourceinfo">
                    {{ s['epcount'] }} <a href={{ s['link'] }}>episodes</a>
                    in season(s): {{ ', '.join(s['seasons']) }}
                  </div>
              {% else %}
                  <div class="sourceinfo">Stream <a href={{ s['link'] }}>movie</a> on {{ s['display_name'] }}</div>
              {% endif %}
              <!-- placeholder links for testing
              {% if s['source'] == 'amazon_prime' %}
                  <div class="sourceinfo"><a href='test'>Watch free with 30-day trial</a></div>
              {% elif s['source'] == 'hbo_now' %}
                  <div class="sourceinfo"><a href='test'>Get HBO on your Amz Prime</a></div>
                  <div class="sourceinfo">Stream on <a href='test'>HBO Now</a> or <a href='test'>HBO Go</a> with TV provider login</div>
              {% elif s['source'] == 'showtime_subscription' %}
                  <div class="sourceinfo"><a href='test'>Get Showtime on your Amz Prime</a></div>
                  <div class="sourceinfo">Stream on <a href='test'>Showtime</a> or <a href='test'>Showtime Anytime</a> with TV provider login</div>
              {% elif s['type'] == 'tv_provider' %}
                  <div class="sourceinfo">Stream with your cable/sat TV account if you have this channel</div>
              {% endif %} -->
            </div>
        {% endfor %}

        <div class="clearfix" style="margin-bottom: 15px"></div>

 
    {% elif media %}  <!-- end-result-ui: search results without a source -->
        <p>
          The {{ mtype }} <strong>{{ media['title'] }} ({{ media['year'] }})</strong>
          <a href='http://www.imdb.com/title/{{ media['imdb'] }}'>imdb</a>
          doesn't seem available on these streaming services.
        </p>


    {% elif query %}  <!-- end-result-ui: no search results -->
        <p>Your search for "{{ query }}" did not match any {{ mtype }} results.</p>
    {% endif %}


    {% if other_results %}  <!-- end-result-ui: list other search results -->
        <div class="clearfix" style="margin-bottom: 2rem">
          <br>...or did you mean?:
          {% for item in other_results %}
              <a href="{{ item['link'] }}">{{ item['title'] }}</a> &nbsp;
          {% endfor %}
        </div>
    {% endif %}
    
{% endblock %}

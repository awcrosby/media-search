{% extends 'layout.html' %}

{% block body %}
    <div>
      <h4>Find if a movie/show is streaming on Netflix, HBO, Hulu, Amazon Prime, or Showtime</h4>
    </div>

    {% include 'includes/_searchbar.html' %}

    <!-- display media image and info if found -->
    {% if media %}
        <div class="clearfix" style="margin-top: 20px">
          <img style="margin-right: 15px; float: left;" src="{{ media['img'] }}" alt="Media result image" />
          <strong>{{ media['title'] }} ({{ media['year'] }})</strong>
          <a href='http://www.imdb.com/title/{{ media['imdb'] }}'>imdb</a>
          {% if session.logged_in %}
            <form method="POST" action="/edit_watchlist">
              <input type="hidden" name="operation" value="add" />
              <input type="hidden" name="mtype" value="{{ mtype }}" />
              <input type="hidden" name="gbid" value="{{ media['id'] }}" />
              <button type="submit" class="btn btn-primary">Add to Watchlist</button>
            </form>
          {% endif %}
        </div>
    {% else %}
        <div class="clearfix" style="margin-top: 20px">
          Your search for "{{ query }}" did not match any {{ mtype }} results.
        </div>
    {% endif %}

    <!-- display sources if found -->
    {% if media and not media['src_display'] %}
        <div class="clearfix" style="margin-top: 20px">
          This {{ mtype }} is not currently available for streaming.
        </div>
    {% elif media and media['src_display'] %}
        <div class="clearfix" style="margin-top: 20px"></div>
        {% for s in media['src_display'] %}
            <!-- display logo or title in source boxes -->
            <div class="source">
              {% if s['source'] in ['netflix', 'hulu_plus', 'amazon_prime', 'hbo_now', 'showtime_subscription'] %}
                  <img class="logo" src="{{ url_for('static', filename=s['source']+'_logo.png') }}" alt="Subscription logo" />
              {% elif s['type'] == 'subscription_web_sources' %}
                  <div class="typefree">Stream with Subscription</div>
                  <div class="name">{{ s['display_name'] }}</div>
              {% elif s['type'] == 'tv_everywhere_web_sources' %}
                  <div class="typetvp">Stream with TV Provider Login</div>
                  <div class="name">{{ s['display_name'] }}</div>
                  <div class="sourceinfo">Stream with your cable/sat TV account if you have this channel</div>
              {% elif s['type'] == 'free_web_sources' %}
                  <div class="typefree">Stream Free</div>
                  <div class="name">{{ s['display_name'] }}</div>
              {% endif %}

              <!-- display source info -->
              {% if mtype == 'show' %}
                  <div class="sourceinfo">
                    {{ s['epcount'] }} <a href={{ s['link'] }}>episodes</a>
                    in season(s): {{ ', '.join(s['seasons']) }}
                  </div>
              {% else %}
                  <div class="sourceinfo">Stream <a href={{ s['link'] }}>movie</a> on {{ s['display_name'] }}</div>
              {% endif %}
              <!-- placeholder links for testing
              {% if s['source'] == 'amazon_prime' %}
                  <div class="sourceinfo"><a href='test'>Watch free with 30-day trial</a></div>
              {% elif s['source'] == 'hbo_now' %}
                  <div class="sourceinfo"><a href='test'>Get HBO on your Amz Prime</a></div>
                  <div class="sourceinfo">Stream on <a href='test'>HBO Now</a> or <a href='test'>HBO Go</a> with TV provider login</div>
              {% elif s['source'] == 'showtime_subscription' %}
                  <div class="sourceinfo"><a href='test'>Get Showtime on your Amz Prime</a></div>
                  <div class="sourceinfo">Stream on <a href='test'>Showtime</a> or <a href='test'>Showtime Anytime</a> with TV provider login</div>
              {% elif s['type'] == 'tv_provider' %}
                  <div class="sourceinfo">Stream with your cable/sat TV account if you have this channel</div>
              {% endif %} -->
            </div>
        {% endfor %}
    {% endif %}

    <!-- list other search results if found -->
    {% if other_results %}
        <div class="clearfix" style="margin-top: 20px">
          ...or did you mean?:
          {% for item in other_results %}
              <a href="{{ item['link'] }}">{{ item['title'] }}</a> &nbsp;
          {% endfor %}
        </div>
    {% endif %}
    
{% endblock %}
